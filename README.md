# NPM Package Template

A production-ready TypeScript template for creating and publishing npm packages. This template provides a complete development environment with modern tooling: dual ESM/CJS builds via tsup, Vitest for testing, ESLint and Prettier for code quality, VitePress for documentation, TypeDoc for API reference generation, Husky for Git hooks, and Changesets for automated versioning and npm publishing through GitHub Actions.

---

## Table of Contents

- [Features](#features)
- [Quick Start](#quick-start)
- [Requirements](#requirements)
- [Project Structure](#project-structure)
- [Scripts Reference](#scripts-reference)
- [Build and Outputs](#build-and-outputs)
- [Code Quality](#code-quality)
- [Git Hooks (Husky + lint-staged)](#git-hooks-husky--lint-staged)
- [Documentation (VitePress)](#documentation-vitepress)
- [API Docs (TypeDoc)](#api-docs-typedoc)
- [CI/CD (GitHub Actions)](#cicd-github-actions)
- [Releases and Versioning (Changesets)](#releases-and-versioning-changesets)
- [GitHub Pages Setup](#github-pages-setup)
- [Customizing the Template](#customizing-the-template)
- [Troubleshooting](#troubleshooting)
- [License](#license)

---

## Features

- **TypeScript 5.x** with strict mode enabled
- **Dual package output** (ESM + CommonJS) via tsup with source maps and declaration files
- **Vitest** for fast unit testing with V8 coverage
- **ESLint 9** with flat config and Prettier integration
- **VitePress** documentation site with hot reload
- **TypeDoc** generates Markdown API docs into VitePress
- **Husky + lint-staged** for pre-commit and pre-push quality gates
- **Changesets** for semantic versioning and automated changelog generation
- **GitHub Actions** workflows for CI, documentation deployment, and npm releases
- **publint** validates package.json exports
- **knip** detects unused dependencies and exports
- **markdownlint** ensures consistent Markdown formatting

---

## Quick Start

### 1. Use this template

Click "Use this template" on GitHub, or clone directly:

```bash
git clone https://github.com/MoaazKHASSAWNEH/NPM-Package.git my-package
cd my-package
rm -rf .git
git init
```

### 2. Enable Corepack and install dependencies

Corepack manages the pnpm version specified in `package.json`:

```bash
corepack enable
pnpm install
```

### 3. Initialize your package

Run the initialization script to replace placeholder values:

```bash
pnpm run init:template
```

This prompts for your package name, description, author, and GitHub username, then updates `package.json`, `LICENSE`, and documentation configs.

### 4. Start developing

```bash
# Build the package once
pnpm run build

# Build in watch mode
pnpm run dev

# Run tests
pnpm run test

# Run tests in watch mode
pnpm run test:watch

# Start documentation dev server
pnpm run docs:dev
```

---

## Requirements

| Requirement        | Version | Notes                                                |
| ------------------ | ------- | ---------------------------------------------------- |
| **Node.js**        | >= 20   | LTS version recommended                              |
| **pnpm**           | 9.0.0   | Managed via Corepack; version pinned in package.json |
| **Git**            | >= 2.x  | Required for Husky hooks                             |
| **GitHub account** | —       | For Actions workflows and Pages deployment           |
| **npm account**    | —       | For publishing packages (requires access token)      |

### Installing pnpm via Corepack

Corepack is included with Node.js 16.10+ and ensures the correct pnpm version:

```bash
corepack enable
```

After enabling, running `pnpm` commands will automatically use pnpm@9.0.0 as specified in `package.json`.

---

## Project Structure

```
├── .github/
│   └── workflows/
│       ├── ci.yml              # CI: lint, test, build, package checks
│       ├── docs.yml            # Build and deploy docs to GitHub Pages
│       └── release.yml         # Changesets: create Release PR or publish
├── .husky/
│   ├── pre-commit              # Runs lint-staged before commit
│   └── pre-push                # Runs lint, typecheck, test, publint before push
├── docs/
│   ├── .vitepress/
│   │   └── config.mts          # VitePress configuration
│   ├── api-generated/          # TypeDoc output (auto-generated)
│   ├── api.md                  # Manual API overview page
│   └── index.md                # Documentation homepage
├── scripts/
│   └── init-template.mjs       # Template initialization script
├── src/
│   └── index.ts                # Package entry point
├── test/
│   └── index.test.ts           # Test files
├── .editorconfig               # Editor formatting rules
├── .gitignore                  # Git ignore patterns
├── .prettierignore             # Prettier ignore patterns
├── .prettierrc                 # Prettier configuration
├── CHANGELOG.md                # Auto-generated by Changesets
├── eslint.config.mjs           # ESLint flat configuration
├── LICENSE                     # MIT license
├── package.json                # Package manifest and scripts
├── pnpm-lock.yaml              # Lockfile
├── tsconfig.build.json         # TypeScript config for builds
├── tsconfig.json               # TypeScript config for development
├── tsup.config.ts              # tsup bundler configuration
├── typedoc.json                # TypeDoc configuration
└── vitest.config.ts            # Vitest configuration
```

### Key Files

| File/Folder           | Purpose                                                        |
| --------------------- | -------------------------------------------------------------- |
| `src/index.ts`        | Main entry point; export your public API here                  |
| `test/`               | Test files; Vitest discovers `*.test.ts` files automatically   |
| `docs/`               | VitePress documentation source                                 |
| `docs/api-generated/` | TypeDoc Markdown output (do not edit manually)                 |
| `tsup.config.ts`      | Configures build output formats, source maps, and tree-shaking |
| `typedoc.json`        | Configures API doc generation                                  |
| `.github/workflows/`  | CI/CD automation                                               |

---

## Scripts Reference

All scripts are defined in `package.json` and run via `pnpm run <script>`.

### Build Scripts

| Script      | Command                      | Description                                  |
| ----------- | ---------------------------- | -------------------------------------------- |
| `build`     | `tsup && pnpm run types:cjs` | Build ESM + CJS bundles with declarations    |
| `types:cjs` | (internal)                   | Copies `.d.ts` to `.d.cts` for CJS consumers |
| `dev`       | `tsup --watch`               | Build in watch mode for development          |

### Type Checking

| Script      | Command                               | Description                       |
| ----------- | ------------------------------------- | --------------------------------- |
| `typecheck` | `tsc -p tsconfig.build.json --noEmit` | Type-check without emitting files |

### Testing

| Script          | Command                 | Description                       |
| --------------- | ----------------------- | --------------------------------- |
| `test`          | `vitest run`            | Run tests once                    |
| `test:watch`    | `vitest`                | Run tests in watch mode           |
| `test:coverage` | `vitest run --coverage` | Run tests with V8 coverage report |

### Code Quality

| Script         | Command                                                 | Description                                 |
| -------------- | ------------------------------------------------------- | ------------------------------------------- |
| `lint`         | `eslint .`                                              | Lint all files with ESLint                  |
| `lint:package` | `publint`                                               | Validate package.json exports configuration |
| `lint:deps`    | `knip`                                                  | Find unused dependencies and exports        |
| `lint:md`      | `markdownlint-cli2 "**/*.md" "!**/node_modules/**" ...` | Lint Markdown files                         |
| `format`       | `prettier . --check`                                    | Check formatting without modifying files    |
| `format:write` | `prettier . --write`                                    | Fix formatting in all files                 |

### Documentation

| Script         | Command                                     | Description                                |
| -------------- | ------------------------------------------- | ------------------------------------------ |
| `docs:dev`     | `vitepress dev docs`                        | Start VitePress dev server with hot reload |
| `docs:build`   | `pnpm run api:docs && vitepress build docs` | Generate API docs and build static site    |
| `docs:preview` | `vitepress preview docs`                    | Preview the built documentation locally    |
| `api:docs`     | `typedoc`                                   | Generate API docs to `docs/api-generated/` |

### Release

| Script             | Command             | Description                                               |
| ------------------ | ------------------- | --------------------------------------------------------- |
| `changeset`        | `changeset`         | Create a new changeset file                               |
| `version-packages` | `changeset version` | Apply changesets and bump version                         |
| `release`          | `changeset publish` | Publish to npm                                            |
| `prepublishOnly`   | (multiple checks)   | Runs lint, publint, typecheck, test, build before publish |

### Utilities

| Script          | Command                            | Description                                       |
| --------------- | ---------------------------------- | ------------------------------------------------- |
| `init:template` | `node ./scripts/init-template.mjs` | Initialize template with your package details     |
| `prepare`       | `husky`                            | Install Git hooks (runs automatically on install) |

---

## Build and Outputs

### tsup Configuration

The build is configured in `tsup.config.ts`:

```typescript
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/index.ts"],
  format: ["esm", "cjs"],
  dts: true,
  sourcemap: true,
  clean: true,
  treeshake: true,
});
```

### Build Output

Running `pnpm run build` produces:

```
dist/
├── index.js        # ESM bundle
├── index.cjs       # CommonJS bundle
├── index.d.ts      # TypeScript declarations (ESM)
├── index.d.cts     # TypeScript declarations (CJS)
├── index.js.map    # Source map (ESM)
└── index.cjs.map   # Source map (CJS)
```

### Package Exports

The `package.json` exports field defines how consumers import your package:

```json
{
  "exports": {
    ".": {
      "import": {
        "types": "./dist/index.d.ts",
        "default": "./dist/index.js"
      },
      "require": {
        "types": "./dist/index.d.cts",
        "default": "./dist/index.cjs"
      }
    }
  }
}
```

### Consumer Usage

```javascript
// ESM (import)
import { myFunction } from "your-package";

// CommonJS (require)
const { myFunction } = require("your-package");
```

Both import styles resolve to the correct bundle with proper TypeScript types.

---

## Code Quality

### ESLint

ESLint 9 uses the flat config format in `eslint.config.mjs`:

```javascript
import eslint from "@eslint/js";
import tseslint from "typescript-eslint";
import prettierConfig from "eslint-config-prettier";

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommended,
  prettierConfig,
  {
    ignores: ["dist/", "docs/.vitepress/", "coverage/"],
  }
);
```

Run linting:

```bash
pnpm run lint
```

### Prettier

Prettier handles code formatting. Configuration is in `.prettierrc`:

```bash
# Check formatting
pnpm run format

# Fix formatting
pnpm run format:write
```

ESLint and Prettier are integrated via `eslint-config-prettier` to avoid conflicts.

### publint

publint validates your `package.json` exports configuration to ensure consumers can correctly import your package:

```bash
pnpm run lint:package
```

Common issues detected:

- Missing or incorrect `exports` paths
- Type declaration mismatches
- Invalid `main`/`module` fields

### knip

knip finds unused dependencies, exports, and files:

```bash
pnpm run lint:deps
```

Review the output and remove any unused code or dependencies.

### markdownlint

markdownlint ensures consistent Markdown formatting:

```bash
pnpm run lint:md
```

The `docs/api-generated/` folder is excluded since TypeDoc generates those files.

---

## Git Hooks (Husky + lint-staged)

### Overview

Husky manages Git hooks, and lint-staged runs linters on staged files only.

| Hook         | File                | What Runs                                              |
| ------------ | ------------------- | ------------------------------------------------------ |
| `pre-commit` | `.husky/pre-commit` | `pnpm lint-staged` (ESLint + Prettier on staged files) |
| `pre-push`   | `.husky/pre-push`   | `lint`, `typecheck`, `test`, `lint:package`            |

### lint-staged Configuration

Defined in `package.json`:

```json
{
  "lint-staged": {
    "*.{ts,tsx,js,mjs,cjs}": ["eslint --fix", "prettier --write"],
    "*.{md,json,yml,yaml}": ["prettier --write"]
  }
}
```

### Installing Hooks

Hooks are installed automatically via the `prepare` script when you run `pnpm install`. To manually reinstall:

```bash
pnpm run prepare
```

### Pre-commit Hook

The pre-commit hook (`.husky/pre-commit`) runs:

```bash
pnpm lint-staged
```

This automatically fixes linting errors and formats staged files before the commit is created.

### Pre-push Hook

The pre-push hook (`.husky/pre-push`) runs:

```bash
pnpm run lint
pnpm run typecheck
pnpm run test
pnpm run lint:package
```

This ensures all quality gates pass before code is pushed to the remote repository.

### Bypassing Hooks

In emergencies, you can skip hooks:

```bash
# Skip pre-commit
git commit --no-verify -m "emergency fix"

# Skip pre-push
git push --no-verify
```

> **Warning**: Use `--no-verify` sparingly. CI will still run all checks.

---

## Documentation (VitePress)

### Overview

VitePress powers the documentation site. Documentation source files are in the `docs/` folder.

### Configuration

VitePress is configured in `docs/.vitepress/config.mts`:

```typescript
import { defineConfig } from "vitepress";

export default defineConfig({
  title: "pkg_name",
  description: "pkg_name documentation",
  themeConfig: {
    nav: [
      { text: "Guide", link: "/" },
      { text: "API", link: "/api" },
    ],
    sidebar: [
      {
        text: "Getting Started",
        items: [{ text: "Overview", link: "/" }],
      },
      {
        text: "Reference",
        items: [
          { text: "API (Overview)", link: "/api" },
          { text: "API (Generated)", link: "/api-generated/" },
        ],
      },
    ],
  },
});
```

### Development

Start the dev server with hot reload:

```bash
pnpm run docs:dev
```

The site is available at `http://localhost:5173/`.

### Building

Build the static site:

```bash
pnpm run docs:build
```

Output is written to `docs/.vitepress/dist/`.

### Preview

Preview the built site locally:

```bash
pnpm run docs:preview
```

### Adding Pages

1. Create a new `.md` file in `docs/` (e.g., `docs/guide/installation.md`)
2. Add the page to the sidebar in `docs/.vitepress/config.mts`
3. Link to it using relative paths: `[Installation](/guide/installation)`

---

## API Docs (TypeDoc)

### Overview

TypeDoc generates API documentation from TSDoc comments in your source code. The `typedoc-plugin-markdown` outputs Markdown files that integrate with VitePress.

### Configuration

TypeDoc is configured in `typedoc.json`:

```json
{
  "entryPoints": ["src/index.ts"],
  "out": "docs/api-generated",
  "name": "pkg_name API",
  "plugin": ["typedoc-plugin-markdown"],
  "readme": "none",
  "hideBreadcrumbs": true,
  "excludePrivate": true,
  "excludeProtected": true,
  "excludeInternal": true,
  "entryFileName": "index.md",
  "sort": ["source-order"]
}
```

### Generating API Docs

```bash
pnpm run api:docs
```

This generates Markdown files in `docs/api-generated/`.

### Integration with VitePress

The `docs:build` script runs `api:docs` first:

```bash
pnpm run docs:build  # Runs api:docs, then vitepress build
```

API docs are accessible at:

- `/api` — Manual overview page (`docs/api.md`)
- `/api-generated/` — Auto-generated reference (`docs/api-generated/index.md`)

### Writing TSDoc Comments

Document your exports with TSDoc:

````typescript
/**
 * Greets a user by name.
 *
 * @param name - The name to greet
 * @returns A greeting message
 *
 * @example
 * ```typescript
 * hello("World"); // "Hello, World!"
 * ```
 */
export function hello(name: string): string {
  return `Hello, ${name}!`;
}
````

### Common Issues

**Missing index.md**: Ensure `entryFileName` in `typedoc.json` is set to `"index.md"`.

**Broken links**: If links to API pages return 404, verify the sidebar configuration points to `/api-generated/` (with trailing slash for directory index).

---

## CI/CD (GitHub Actions)

Three workflows automate testing, documentation, and releases.

### CI Workflow (`.github/workflows/ci.yml`)

**Triggers**: Pull requests, pushes to `main`

**Steps**:

1. Checkout code
2. Setup Node.js 20 with pnpm cache
3. Enable Corepack
4. Install dependencies with `--frozen-lockfile`
5. Run ESLint (`pnpm run lint`)
6. Run TypeScript type checking (`pnpm run typecheck`)
7. Run Vitest tests (`pnpm run test`)
8. Build with tsup (`pnpm run build`)
9. Run publint (`pnpm run lint:package`)
10. Run knip (`pnpm run lint:deps`)
11. Run markdownlint (`pnpm run lint:md`)
12. Build documentation (`pnpm run docs:build`)

### Docs Workflow (`.github/workflows/docs.yml`)

**Triggers**: Pushes to `main`, manual dispatch

**Steps**:

1. Build documentation with VitePress
2. Upload as Pages artifact
3. Deploy to GitHub Pages

**Permissions required**: `pages: write`, `id-token: write`

### Release Workflow (`.github/workflows/release.yml`)

**Triggers**: Pushes to `main`

**Steps**:

1. Checkout with full history (`fetch-depth: 0`)
2. Setup Node.js with npm registry
3. Enable Corepack
4. Install dependencies
5. Run quality gates (lint, typecheck, test, build)
6. Run `changesets/action`:
   - If changesets exist: Creates a "Version Packages" PR
   - If Version Packages PR is merged: Publishes to npm

**Required secrets**:

| Secret         | Description                                   |
| -------------- | --------------------------------------------- |
| `GITHUB_TOKEN` | Automatic; used for creating PRs              |
| `NPM_TOKEN`    | npm automation token; required for publishing |

### Corepack in CI

All workflows enable Corepack to use the pnpm version from `package.json`:

```yaml
- name: Enable Corepack
  run: corepack enable
```

### Frozen Lockfile

CI uses `--frozen-lockfile` to ensure reproducible installs:

```yaml
- name: Install dependencies
  run: pnpm install --frozen-lockfile
```

If this fails, your lockfile is out of sync. See [Troubleshooting](#troubleshooting).

---

## Releases and Versioning (Changesets)

### Overview

Changesets manages versioning, changelogs, and npm publishing. The workflow:

1. Create changesets during development
2. Push to `main`
3. CI creates a "Version Packages" PR
4. Merge the PR to publish

### Creating a Changeset

After making changes, create a changeset:

```bash
pnpm run changeset
```

You will be prompted to:

1. Select the packages to include
2. Choose a bump type:
   - **patch** (0.0.X): Bug fixes, documentation updates
   - **minor** (0.X.0): New features, backward-compatible changes
   - **major** (X.0.0): Breaking changes
3. Write a summary (appears in CHANGELOG.md)

### Changeset Files

Changesets are stored as Markdown files in `.changeset/`:

```markdown
---
"your-package": minor
---

Added new utility function for data transformation.
```

Commit these files with your changes:

```bash
git add .changeset/
git commit -m "feat: add data transformation utility"
git push
```

### Automated Release Process

When you push to `main`:

1. **If changesets exist**: The release workflow creates a "Version Packages" PR containing:
   - Bumped version in `package.json`
   - Updated `CHANGELOG.md`
   - Deleted changeset files

2. **When you merge the Version Packages PR**: The workflow publishes to npm.

### Required Secrets

Add `NPM_TOKEN` to your repository secrets:

1. Go to [npmjs.com](https://www.npmjs.com/) → Access Tokens
2. Generate a new **Automation** token
3. In GitHub: Settings → Secrets and variables → Actions
4. Add `NPM_TOKEN` with the token value

### CHANGELOG.md

`CHANGELOG.md` is auto-generated by Changesets. Do not edit it manually.

### Manual Release (Not Recommended)

If you must release manually:

```bash
pnpm run version-packages   # Apply changesets, bump version
pnpm run build              # Build the package
pnpm run release            # Publish to npm
```

---

## GitHub Pages Setup

### Enable GitHub Pages

1. Go to your repository → Settings → Pages
2. Under "Build and deployment", set Source to **GitHub Actions**
3. Save

The `docs.yml` workflow will automatically deploy on pushes to `main`.

### VitePress Base Path

If your repository is not at the root domain (e.g., `username.github.io/repo-name`), configure the `base` option in `docs/.vitepress/config.mts`:

```typescript
export default defineConfig({
  base: "/NPM-Package/", // Replace with your repository name
  // ...
});
```

Without this, assets and links will return 404.

### Deployment URL

After deployment, your docs are available at:

```
https://<username>.github.io/<repo-name>/
```

---

## Customizing the Template

### Running the Initialization Script

The easiest way to customize is the init script:

```bash
pnpm run init:template
```

This prompts for:

- **Package name**: Your npm package name
- **Description**: Package description
- **Author**: Your name
- **GitHub username**: For repository URLs

The script updates:

- `package.json` (name, description, author, repository, bugs, homepage)
- `LICENSE` (copyright holder)
- `docs/.vitepress/config.mts` (title, description)
- `typedoc.json` (name)

### Manual Customization

If you prefer manual updates, replace these placeholders:

| Placeholder       | Location                         | Replace With         |
| ----------------- | -------------------------------- | -------------------- |
| `pkg_name`        | package.json, typedoc.json, docs | Your package name    |
| `pkg_name_author` | package.json, LICENSE            | Your name            |
| `MoaazKHASSAWNEH` | package.json (repository URL)    | Your GitHub username |
| `NPM-Package`     | package.json (repository URL)    | Your repository name |

### Updating Repository Fields

Ensure these fields in `package.json` match your repository:

```json
{
  "repository": {
    "type": "git",
    "url": "git+https://github.com/YOUR_USERNAME/YOUR_REPO.git"
  },
  "bugs": {
    "url": "https://github.com/YOUR_USERNAME/YOUR_REPO/issues"
  },
  "homepage": "https://github.com/YOUR_USERNAME/YOUR_REPO#readme"
}
```

### Keywords

Update the `keywords` array for npm discoverability:

```json
{
  "keywords": ["typescript", "utility", "your-keyword"]
}
```

---

## Troubleshooting

### `pnpm install --frozen-lockfile` fails in CI

**Error**: `ERR_PNPM_FROZEN_LOCKFILE_WITH_OUTDATED_LOCKFILE`

**Cause**: `pnpm-lock.yaml` is out of sync with `package.json`.

**Solution**:

```bash
pnpm install
git add pnpm-lock.yaml
git commit -m "chore: update lockfile"
git push
```

### publint warnings about exports

**Cause**: `package.json` exports don't match files in `dist/`.

**Solution**:

1. Run `pnpm run build` to generate dist files
2. Verify `exports` paths match actual files
3. Run `pnpm run lint:package` to validate

### Documentation 404 on GitHub Pages

**Cause**: Missing or incorrect `base` path in VitePress config.

**Solution**: Set `base` in `docs/.vitepress/config.mts`:

```typescript
export default defineConfig({
  base: "/your-repo-name/",
  // ...
});
```

### Husky hooks not running

**Cause**: Hooks not installed, or Git not initialized.

**Solution**:

```bash
# Ensure Git is initialized
git init

# Reinstall hooks
pnpm run prepare
```

**On Windows / Git Bash**: Ensure you're using Git Bash or a compatible terminal. Some terminals may not execute hooks correctly.

### Husky hooks not running on Windows

**Cause**: Windows line endings or shell issues.

**Solution**:

1. Ensure `.husky/` files use LF line endings (not CRLF)
2. Run from Git Bash, not PowerShell or CMD
3. Reinstall hooks: `pnpm run prepare`

### TypeDoc output missing index.md

**Cause**: `entryFileName` not set in `typedoc.json`.

**Solution**: Ensure `typedoc.json` includes:

```json
{
  "entryFileName": "index.md"
}
```

Regenerate: `pnpm run api:docs`

### Tests fail in CI but pass locally

**Causes**:

- Environment differences
- Dependencies not in lockfile
- Different Node.js version

**Solutions**:

1. Run with frozen lockfile locally: `pnpm install --frozen-lockfile`
2. Ensure Node.js version matches CI (>= 20)
3. Commit any lockfile changes

### NPM_TOKEN error during release

**Error**: `NODE_AUTH_TOKEN` is not set.

**Solution**:

1. Create an npm automation token at npmjs.com
2. Add it as `NPM_TOKEN` in GitHub repository secrets (Settings → Secrets → Actions)

### Changesets not creating Release PR

**Causes**:

- No changeset files in `.changeset/`
- Workflow permissions issue

**Solutions**:

1. Create a changeset: `pnpm run changeset`
2. Verify workflow has `contents: write` and `pull-requests: write` permissions
3. Check Actions tab for workflow errors

---

## License

This project is licensed under the MIT License. See [LICENSE](LICENSE) for the full text.

Copyright © 2026 Moaaz KHASSAWNEH
