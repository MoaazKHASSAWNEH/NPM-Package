# ðŸ“¦ NPM Package Template

> A modern, production-ready TypeScript starter for publishing npm packages.

<p align="center">
  <a href="#-quick-start">English</a> â€¢
  <a href="#-dÃ©marrage-rapide">FranÃ§ais</a>
</p>

---

## Table of Contents

- [Quick Start](#-quick-start)
- [Features](#-features)
- [Requirements](#-requirements)
- [Project Structure](#-project-structure)
- [Available Scripts](#-available-scripts)
- [Build System (tsup)](#-build-system-tsup)
- [Testing (Vitest)](#-testing-vitest)
- [Code Quality](#-code-quality)
- [Git Hooks (Husky + lint-staged)](#-git-hooks-husky--lint-staged)
- [Documentation (VitePress + TypeDoc)](#-documentation-vitepress--typedoc)
- [Versioning & Publishing (Changesets)](#-versioning--publishing-changesets)
- [CI/CD (GitHub Actions)](#-cicd-github-actions)
- [Troubleshooting](#-troubleshooting)
- [License](#-license)

---

## ðŸš€ Quick Start

### 1. Use this template

```bash
# Clone the repository
git clone https://github.com/MoaazKHASSAWNEH/NPM-Package.git my-package
cd my-package

# Remove the existing git history and start fresh
rm -rf .git
git init
```

### 2. Enable Corepack and install dependencies

```bash
corepack enable
pnpm install
```

### 3. Initialize your package

```bash
pnpm run init:template
```

This interactive script will prompt you for:

- **Package name** (e.g., `my-awesome-lib`)
- **Package description**
- **Author name**
- **GitHub username** (for repository URL)

It automatically updates `package.json`, `LICENSE`, documentation configs, and cleans up the initialization script.

### 4. Start developing

```bash
# Build once
pnpm run build

# Watch mode (rebuild on changes)
pnpm run dev

# Run tests
pnpm run test

# Run tests in watch mode
pnpm run test:watch
```

---

## âœ¨ Features

| Category           | Tools & Technologies                           |
| ------------------ | ---------------------------------------------- |
| **Language**       | TypeScript 5.x with strict mode                |
| **Build**          | tsup (ESM + CJS dual output)                   |
| **Test**           | Vitest with coverage (V8)                      |
| **Lint**           | ESLint 9 (flat config) + Prettier              |
| **Documentation**  | VitePress + TypeDoc (auto-generated API docs)  |
| **Versioning**     | Changesets (semantic versioning & changelogs)  |
| **Git Hooks**      | Husky + lint-staged (automated quality checks) |
| **CI/CD**          | GitHub Actions (test, docs, release)           |
| **Package Checks** | publint + knip (exports validation, dead code) |

---

## ðŸ“‹ Requirements

| Tool        | Version | Notes                |
| ----------- | ------- | -------------------- |
| **Node.js** | â‰¥ 20    | LTS recommended      |
| **pnpm**    | â‰¥ 9.0.0 | Managed via Corepack |
| **Git**     | â‰¥ 2.x   | For Husky hooks      |

### Enable Corepack

Corepack ensures you use the correct pnpm version specified in `package.json`:

```bash
corepack enable
```

---

## ðŸ“ Project Structure

```
â”œâ”€â”€ .changeset/              # Changesets configuration
â”‚   â””â”€â”€ config.json          # Changeset settings (changelog, access, etc.)
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml           # Lint, test, build on PR/push
â”‚       â”œâ”€â”€ docs.yml         # Build & deploy docs to GitHub Pages
â”‚       â””â”€â”€ release.yml      # Changesets release automation
â”œâ”€â”€ .husky/                  # Git hooks
â”‚   â”œâ”€â”€ commit-msg           # Commit message validation (optional)
â”‚   â”œâ”€â”€ pre-commit           # Runs lint-staged before commit
â”‚   â””â”€â”€ pre-push             # Runs lint, typecheck, test before push
â”œâ”€â”€ docs/                    # VitePress documentation
â”‚   â”œâ”€â”€ .vitepress/
â”‚   â”‚   â””â”€â”€ config.mts       # VitePress configuration
â”‚   â”œâ”€â”€ api-generated/       # Auto-generated API docs (TypeDoc)
â”‚   â”œâ”€â”€ api.md               # Manual API overview
â”‚   â””â”€â”€ index.md             # Documentation homepage
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-template.mjs    # Template initialization script
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts             # Package entry point
â”œâ”€â”€ test/
â”‚   â””â”€â”€ index.test.ts        # Test files
â”œâ”€â”€ dist/                    # Build output (generated)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ CHANGELOG.md             # Auto-generated by Changesets
â”œâ”€â”€ eslint.config.mjs        # ESLint flat configuration
â”œâ”€â”€ LICENSE                  # MIT license
â”œâ”€â”€ package.json             # Package configuration
â”œâ”€â”€ pnpm-lock.yaml           # Lockfile
â”œâ”€â”€ README.md                # This file
â”œâ”€â”€ tsconfig.json            # TypeScript configuration (development)
â”œâ”€â”€ tsconfig.build.json      # TypeScript configuration (build)
â”œâ”€â”€ tsup.config.ts           # tsup bundler configuration
â”œâ”€â”€ typedoc.json             # TypeDoc configuration
â””â”€â”€ vitest.config.ts         # Vitest configuration
```

---

## ðŸ“œ Available Scripts

### Core Development

| Command              | Description                           |
| -------------------- | ------------------------------------- |
| `pnpm run build`     | Build the package (ESM + CJS + types) |
| `pnpm run dev`       | Build in watch mode                   |
| `pnpm run typecheck` | Run TypeScript type checking          |

### Testing

| Command                  | Description                    |
| ------------------------ | ------------------------------ |
| `pnpm run test`          | Run tests once                 |
| `pnpm run test:watch`    | Run tests in watch mode        |
| `pnpm run test:coverage` | Run tests with coverage report |

### Code Quality

| Command                 | Description                                 |
| ----------------------- | ------------------------------------------- |
| `pnpm run lint`         | Run ESLint                                  |
| `pnpm run lint:package` | Run publint (validate package.json exports) |
| `pnpm run lint:deps`    | Run knip (find unused deps/exports)         |
| `pnpm run lint:md`      | Run markdownlint                            |
| `pnpm run format`       | Check formatting with Prettier              |
| `pnpm run format:write` | Fix formatting with Prettier                |

### Documentation

| Command                 | Description                        |
| ----------------------- | ---------------------------------- |
| `pnpm run docs:dev`     | Start VitePress dev server         |
| `pnpm run docs:build`   | Build documentation for production |
| `pnpm run docs:preview` | Preview built documentation        |
| `pnpm run api:docs`     | Generate API docs with TypeDoc     |

### Release

| Command                     | Description                        |
| --------------------------- | ---------------------------------- |
| `pnpm run changeset`        | Create a new changeset             |
| `pnpm run version-packages` | Apply changesets and bump versions |
| `pnpm run release`          | Publish to npm                     |

### Utilities

| Command                  | Description                               |
| ------------------------ | ----------------------------------------- |
| `pnpm run init:template` | Initialize the template with your details |
| `pnpm run prepare`       | Install Husky git hooks (runs on install) |

---

## ðŸ”¨ Build System (tsup)

[tsup](https://tsup.egoist.dev/) is a zero-config TypeScript bundler powered by esbuild.

### Configuration

**tsup.config.ts:**

```typescript
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/index.ts"],
  format: ["esm", "cjs"],
  dts: true,
  clean: true,
  sourcemap: true,
});
```

### Build Output

```
dist/
â”œâ”€â”€ index.js      # ESM bundle
â”œâ”€â”€ index.cjs     # CommonJS bundle
â”œâ”€â”€ index.d.ts    # TypeScript declarations (ESM)
â”œâ”€â”€ index.d.cts   # TypeScript declarations (CJS)
â””â”€â”€ index.js.map  # Source maps
```

### Dual Package Support

The package supports both ESM and CommonJS consumers:

```javascript
// ESM
import { hello } from "your-package";

// CommonJS
const { hello } = require("your-package");
```

---

## ðŸ§ª Testing (Vitest)

[Vitest](https://vitest.dev/) is a blazing-fast unit testing framework.

### Configuration

**vitest.config.ts:**

```typescript
import { defineConfig } from "vitest/config";

export default defineConfig({
  test: {
    globals: true,
    coverage: {
      provider: "v8",
      reporter: ["text", "html", "lcov"],
    },
  },
});
```

### Writing Tests

```typescript
// test/index.test.ts
import { describe, it, expect } from "vitest";
import { hello } from "../src/index";

describe("hello", () => {
  it("should return greeting message", () => {
    expect(hello("World")).toBe("Hello, World!");
  });
});
```

### Running Tests

```bash
# Run once
pnpm run test

# Watch mode
pnpm run test:watch

# With coverage
pnpm run test:coverage
```

---

## ðŸ” Code Quality

### ESLint

ESLint 9 with flat config for TypeScript:

**eslint.config.mjs:**

```javascript
import eslint from "@eslint/js";
import tseslint from "typescript-eslint";
import prettierConfig from "eslint-config-prettier";

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommended,
  prettierConfig,
  {
    ignores: ["dist/", "docs/.vitepress/", "coverage/"],
  }
);
```

### Prettier

Code formatting with Prettier:

```bash
# Check formatting
pnpm run format

# Fix formatting
pnpm run format:write
```

### publint

Validates your `package.json` exports configuration:

```bash
pnpm run lint:package
```

### knip

Finds unused dependencies, exports, and files:

```bash
pnpm run lint:deps
```

---

## ðŸª Git Hooks (Husky + lint-staged)

[Husky](https://typicode.github.io/husky/) enables Git hooks, and [lint-staged](https://github.com/lint-staged/lint-staged) runs linters on staged files.

### Automatic Setup

Husky is installed automatically via the `prepare` script:

```json
{
  "scripts": {
    "prepare": "husky"
  }
}
```

### Configured Hooks

| Hook           | File                | Actions                                  |
| -------------- | ------------------- | ---------------------------------------- |
| **pre-commit** | `.husky/pre-commit` | Runs `lint-staged` on staged files       |
| **pre-push**   | `.husky/pre-push`   | Runs lint, typecheck, test, lint:package |
| **commit-msg** | `.husky/commit-msg` | (Optional) Validate commit messages      |

### lint-staged Configuration

Defined in `package.json`:

```json
{
  "lint-staged": {
    "*.{ts,tsx,js,mjs,cjs}": ["eslint --fix", "prettier --write"],
    "*.{md,json,yml,yaml}": ["prettier --write"]
  }
}
```

### Hook Details

**pre-commit** (`.husky/pre-commit`):

```bash
pnpm lint-staged
```

Automatically fixes linting errors and formats staged files before commit.

**pre-push** (`.husky/pre-push`):

```bash
pnpm run lint
pnpm run typecheck
pnpm run test
pnpm run lint:package
```

Ensures all quality gates pass before pushing to remote.

### Bypassing Hooks (Emergency Only)

```bash
# Skip pre-commit hook
git commit --no-verify -m "emergency fix"

# Skip pre-push hook
git push --no-verify
```

> âš ï¸ **Warning**: Only use `--no-verify` in emergencies. CI will still run all checks.

---

## ðŸ“š Documentation (VitePress + TypeDoc)

### VitePress

[VitePress](https://vitepress.dev/) powers the documentation site.

**Configuration** (`docs/.vitepress/config.mts`):

```typescript
import { defineConfig } from "vitepress";

export default defineConfig({
  title: "pkg_name",
  description: "pkg_name documentation",
  // For GitHub Pages with custom repo name, add:
  // base: "/your-repo-name/",
  themeConfig: {
    nav: [
      { text: "Guide", link: "/" },
      { text: "API", link: "/api" },
    ],
    sidebar: [
      {
        text: "Getting Started",
        items: [{ text: "Overview", link: "/" }],
      },
      {
        text: "Reference",
        items: [
          { text: "API (Overview)", link: "/api" },
          { text: "API (Generated)", link: "/api-generated/" },
        ],
      },
    ],
  },
});
```

### TypeDoc

[TypeDoc](https://typedoc.org/) generates API documentation from TSDoc comments.

**Configuration** (`typedoc.json`):

```json
{
  "entryPoints": ["src/index.ts"],
  "out": "docs/api-generated",
  "plugin": ["typedoc-plugin-markdown"]
}
```

### GitHub Pages Setup

> **Important**: If your repository is not at the root (e.g., `username.github.io/repo-name`), you must set the `base` option in VitePress config:

```typescript
// docs/.vitepress/config.mts
export default defineConfig({
  base: "/NPM-Package/", // Replace with your repo name
  // ...
});
```

### Local Development

```bash
# Start documentation dev server
pnpm run docs:dev

# Build documentation
pnpm run docs:build

# Preview built docs
pnpm run docs:preview
```

---

## ðŸ“¦ Versioning & Publishing (Changesets)

[Changesets](https://github.com/changesets/changesets) manages versioning and changelogs.

### Workflow Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHANGESETS WORKFLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. DEVELOP                                                  â”‚
â”‚     â””â”€> Make changes to your code                           â”‚
â”‚                                                              â”‚
â”‚  2. CREATE CHANGESET                                         â”‚
â”‚     â””â”€> pnpm run changeset                                  â”‚
â”‚         â€¢ Select change type (patch/minor/major)            â”‚
â”‚         â€¢ Write change description                          â”‚
â”‚         â€¢ Creates .changeset/*.md file                      â”‚
â”‚                                                              â”‚
â”‚  3. COMMIT & PUSH                                           â”‚
â”‚     â””â”€> Git commit includes changeset file                  â”‚
â”‚                                                              â”‚
â”‚  4. AUTOMATED (GitHub Actions)                              â”‚
â”‚     â”œâ”€> Creates "Version Packages" PR with:                 â”‚
â”‚     â”‚   â€¢ Version bumps in package.json                     â”‚
â”‚     â”‚   â€¢ Updated CHANGELOG.md                              â”‚
â”‚     â”‚                                                        â”‚
â”‚     â””â”€> On PR merge: publishes to npm automatically         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step-by-Step Guide

#### 1. Create a Changeset

After making changes, create a changeset:

```bash
pnpm run changeset
```

You'll be prompted to:

1. **Select packages** (press `Space` to select, `Enter` to confirm)
2. **Choose bump type**:
   - `patch` (0.0.X) â€“ Bug fixes, documentation
   - `minor` (0.X.0) â€“ New features, backward-compatible
   - `major` (X.0.0) â€“ Breaking changes
3. **Write a summary** â€“ Describe the changes (appears in CHANGELOG)

#### 2. Changeset File

A markdown file is created in `.changeset/`:

```markdown
---
"your-package": minor
---

Added new utility function for data transformation.
```

#### 3. Commit the Changeset

```bash
git add .changeset/
git commit -m "feat: add data transformation utility"
git push
```

#### 4. Automated Release (CI)

The `release.yml` workflow:

1. **Detects changesets** on push to `main`
2. **Creates/updates** a "Version Packages" PR with:
   - Bumped version in `package.json`
   - Updated `CHANGELOG.md`
   - Consumed changeset files
3. **When you merge** the Version Packages PR:
   - Publishes to npm automatically
   - Creates a GitHub release

### Configuration

**.changeset/config.json:**

```json
{
  "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",
  "changelog": "@changesets/cli/changelog",
  "commit": false,
  "fixed": [],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": []
}
```

### Manual Release (Not Recommended)

If you need to release manually:

```bash
# Apply changesets and bump versions
pnpm run version-packages

# Build and publish
pnpm run build
pnpm run release
```

---

## ðŸ”„ CI/CD (GitHub Actions)

Three workflows automate quality checks, documentation, and releases.

### 1. CI Workflow (`ci.yml`)

**Triggers**: Push to `main`, Pull Requests

**Jobs**:

| Step                | Command                 |
| ------------------- | ----------------------- |
| Lint (ESLint)       | `pnpm run lint`         |
| Typecheck (tsc)     | `pnpm run typecheck`    |
| Unit tests (Vitest) | `pnpm run test`         |
| Build (tsup)        | `pnpm run build`        |
| Package lint        | `pnpm run lint:package` |
| Unused deps (knip)  | `pnpm run lint:deps`    |
| Markdown lint       | `pnpm run lint:md`      |
| Docs build          | `pnpm run docs:build`   |

### 2. Docs Workflow (`docs.yml`)

**Triggers**: Push to `main`, Manual dispatch

**Jobs**:

1. **Build**: Generates documentation with VitePress
2. **Deploy**: Publishes to GitHub Pages

**Requirements**:

- Enable GitHub Pages in repository settings
- Set source to "GitHub Actions"

### 3. Release Workflow (`release.yml`)

**Triggers**: Push to `main`

**Jobs**:

1. **Quality Gates**: Runs lint, typecheck, test, build
2. **Changesets Action**:
   - If changesets exist: Creates "Version Packages" PR
   - If Version Packages PR merged: Publishes to npm

**Required Secrets**:

| Secret         | Description                       |
| -------------- | --------------------------------- |
| `GITHUB_TOKEN` | Automatic (for PR creation)       |
| `NPM_TOKEN`    | npm access token (for publishing) |

### Setting Up NPM_TOKEN

1. Go to [npmjs.com](https://www.npmjs.com/) â†’ Account â†’ Access Tokens
2. Generate a new **Automation** token
3. In GitHub repo: Settings â†’ Secrets â†’ Actions
4. Add `NPM_TOKEN` with the token value

---

## ðŸ”§ Troubleshooting

### "Frozen lockfile" error in CI

**Error**: `ERR_PNPM_FROZEN_LOCKFILE_WITH_OUTDATED_LOCKFILE`

**Cause**: `pnpm-lock.yaml` is out of sync with `package.json`

**Solution**:

```bash
pnpm install
git add pnpm-lock.yaml
git commit -m "chore: update lockfile"
```

### Documentation 404 on GitHub Pages

**Cause**: Missing `base` path in VitePress config

**Solution**: Add the base path in `docs/.vitepress/config.mts`:

```typescript
export default defineConfig({
  base: "/your-repo-name/", // Must match your GitHub repo name
  // ...
});
```

### NPM_TOKEN missing error

**Error**: `NODE_AUTH_TOKEN` is not set

**Cause**: npm token not configured in GitHub secrets

**Solution**:

1. Create an npm automation token at npmjs.com
2. Add it as `NPM_TOKEN` in GitHub repository secrets

### publint warnings

**Warning**: Package exports issues

**Cause**: `package.json` exports don't match actual files

**Solution**:

1. Run `pnpm run build` to generate dist files
2. Verify `exports` field matches generated files
3. Run `pnpm run lint:package` to validate

### Husky hooks not running

**Cause**: Hooks not installed or Git not initialized

**Solution**:

```bash
# Ensure Git is initialized
git init

# Reinstall hooks
pnpm run prepare
```

### Tests fail in CI but pass locally

**Cause**: Environment differences or missing dependencies

**Solution**:

1. Ensure all dependencies are in `devDependencies`
2. Run with `--frozen-lockfile` locally: `pnpm install --frozen-lockfile`
3. Check Node.js version matches CI (â‰¥20)

---

## ðŸ“„ License

MIT License Â© 2026 [Moaaz KHASSAWNEH](https://github.com/MoaazKHASSAWNEH)

See [LICENSE](LICENSE) for details.

---

---

# ðŸ“¦ ModÃ¨le de Package NPM

> Un starter TypeScript moderne et prÃªt pour la production, conÃ§u pour publier des packages npm.

---

## Table des matiÃ¨res

- [DÃ©marrage rapide](#-dÃ©marrage-rapide)
- [FonctionnalitÃ©s](#-fonctionnalitÃ©s)
- [PrÃ©requis](#-prÃ©requis)
- [Structure du projet](#-structure-du-projet)
- [Scripts disponibles](#-scripts-disponibles)
- [SystÃ¨me de build (tsup)](#-systÃ¨me-de-build-tsup)
- [Tests (Vitest)](#-tests-vitest)
- [QualitÃ© du code](#-qualitÃ©-du-code)
- [Hooks Git (Husky + lint-staged)](#-hooks-git-husky--lint-staged)
- [Documentation (VitePress + TypeDoc)](#-documentation-vitepress--typedoc)
- [Versionnage et publication (Changesets)](#-versionnage-et-publication-changesets)
- [CI/CD (GitHub Actions)](#-cicd-github-actions)
- [DÃ©pannage](#-dÃ©pannage)
- [Licence](#-licence)

---

## ðŸš€ DÃ©marrage rapide

### 1. Utiliser ce modÃ¨le

```bash
# Cloner le dÃ©pÃ´t
git clone https://github.com/MoaazKHASSAWNEH/NPM-Package.git mon-package
cd mon-package

# Supprimer l'historique git existant et recommencer Ã  zÃ©ro
rm -rf .git
git init
```

### 2. Activer Corepack et installer les dÃ©pendances

```bash
corepack enable
pnpm install
```

### 3. Initialiser votre package

```bash
pnpm run init:template
```

Ce script interactif vous demandera :

- **Nom du package** (ex: `ma-super-lib`)
- **Description du package**
- **Nom de l'auteur**
- **Nom d'utilisateur GitHub** (pour l'URL du dÃ©pÃ´t)

Il met automatiquement Ã  jour `package.json`, `LICENSE`, les configs de documentation et supprime le script d'initialisation.

### 4. Commencer Ã  dÃ©velopper

```bash
# Build une fois
pnpm run build

# Mode watch (rebuild automatique)
pnpm run dev

# Lancer les tests
pnpm run test

# Tests en mode watch
pnpm run test:watch
```

---

## âœ¨ FonctionnalitÃ©s

| CatÃ©gorie         | Outils et technologies                           |
| ----------------- | ------------------------------------------------ |
| **Langage**       | TypeScript 5.x avec mode strict                  |
| **Build**         | tsup (sortie double ESM + CJS)                   |
| **Tests**         | Vitest avec couverture (V8)                      |
| **Lint**          | ESLint 9 (flat config) + Prettier                |
| **Documentation** | VitePress + TypeDoc (docs API auto-gÃ©nÃ©rÃ©es)     |
| **Versionnage**   | Changesets (versionnage sÃ©mantique & changelogs) |
| **Hooks Git**     | Husky + lint-staged (vÃ©rifications automatiques) |
| **CI/CD**         | GitHub Actions (test, docs, release)             |
| **VÃ©rifications** | publint + knip (validation exports, code mort)   |

---

## ðŸ“‹ PrÃ©requis

| Outil       | Version | Notes                |
| ----------- | ------- | -------------------- |
| **Node.js** | â‰¥ 20    | LTS recommandÃ©       |
| **pnpm**    | â‰¥ 9.0.0 | GÃ©rÃ© via Corepack    |
| **Git**     | â‰¥ 2.x   | Pour les hooks Husky |

### Activer Corepack

Corepack garantit l'utilisation de la bonne version de pnpm spÃ©cifiÃ©e dans `package.json` :

```bash
corepack enable
```

---

## ðŸ“ Structure du projet

```
â”œâ”€â”€ .changeset/              # Configuration Changesets
â”‚   â””â”€â”€ config.json          # ParamÃ¨tres (changelog, access, etc.)
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml           # Lint, test, build sur PR/push
â”‚       â”œâ”€â”€ docs.yml         # Build & dÃ©ploiement docs GitHub Pages
â”‚       â””â”€â”€ release.yml      # Automatisation release Changesets
â”œâ”€â”€ .husky/                  # Hooks Git
â”‚   â”œâ”€â”€ commit-msg           # Validation message de commit (optionnel)
â”‚   â”œâ”€â”€ pre-commit           # ExÃ©cute lint-staged avant commit
â”‚   â””â”€â”€ pre-push             # ExÃ©cute lint, typecheck, test avant push
â”œâ”€â”€ docs/                    # Documentation VitePress
â”‚   â”œâ”€â”€ .vitepress/
â”‚   â”‚   â””â”€â”€ config.mts       # Configuration VitePress
â”‚   â”œâ”€â”€ api-generated/       # Docs API auto-gÃ©nÃ©rÃ©es (TypeDoc)
â”‚   â”œâ”€â”€ api.md               # AperÃ§u API manuel
â”‚   â””â”€â”€ index.md             # Page d'accueil documentation
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-template.mjs    # Script d'initialisation du modÃ¨le
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts             # Point d'entrÃ©e du package
â”œâ”€â”€ test/
â”‚   â””â”€â”€ index.test.ts        # Fichiers de test
â”œâ”€â”€ dist/                    # Sortie du build (gÃ©nÃ©rÃ©)
â”œâ”€â”€ CHANGELOG.md             # Auto-gÃ©nÃ©rÃ© par Changesets
â”œâ”€â”€ eslint.config.mjs        # Configuration ESLint flat
â”œâ”€â”€ LICENSE                  # Licence MIT
â”œâ”€â”€ package.json             # Configuration du package
â”œâ”€â”€ pnpm-lock.yaml           # Fichier de verrouillage
â”œâ”€â”€ README.md                # Ce fichier
â”œâ”€â”€ tsconfig.json            # Configuration TypeScript (dÃ©veloppement)
â”œâ”€â”€ tsconfig.build.json      # Configuration TypeScript (build)
â”œâ”€â”€ tsup.config.ts           # Configuration du bundler tsup
â”œâ”€â”€ typedoc.json             # Configuration TypeDoc
â””â”€â”€ vitest.config.ts         # Configuration Vitest
```

---

## ðŸ“œ Scripts disponibles

### DÃ©veloppement principal

| Commande             | Description                          |
| -------------------- | ------------------------------------ |
| `pnpm run build`     | Build le package (ESM + CJS + types) |
| `pnpm run dev`       | Build en mode watch                  |
| `pnpm run typecheck` | VÃ©rification des types TypeScript    |

### Tests

| Commande                 | Description                      |
| ------------------------ | -------------------------------- |
| `pnpm run test`          | Lancer les tests une fois        |
| `pnpm run test:watch`    | Tests en mode watch              |
| `pnpm run test:coverage` | Tests avec rapport de couverture |

### QualitÃ© du code

| Commande                | Description                                     |
| ----------------------- | ----------------------------------------------- |
| `pnpm run lint`         | ExÃ©cuter ESLint                                 |
| `pnpm run lint:package` | ExÃ©cuter publint (valider exports package.json) |
| `pnpm run lint:deps`    | ExÃ©cuter knip (trouver deps/exports inutilisÃ©s) |
| `pnpm run lint:md`      | ExÃ©cuter markdownlint                           |
| `pnpm run format`       | VÃ©rifier le formatage avec Prettier             |
| `pnpm run format:write` | Corriger le formatage avec Prettier             |

### Documentation

| Commande                | Description                            |
| ----------------------- | -------------------------------------- |
| `pnpm run docs:dev`     | DÃ©marrer le serveur de dev VitePress   |
| `pnpm run docs:build`   | Build la documentation pour production |
| `pnpm run docs:preview` | PrÃ©visualiser la documentation buildÃ©e |
| `pnpm run api:docs`     | GÃ©nÃ©rer les docs API avec TypeDoc      |

### Release

| Commande                    | Description                               |
| --------------------------- | ----------------------------------------- |
| `pnpm run changeset`        | CrÃ©er un nouveau changeset                |
| `pnpm run version-packages` | Appliquer les changesets et bump versions |
| `pnpm run release`          | Publier sur npm                           |

### Utilitaires

| Commande                 | Description                                 |
| ------------------------ | ------------------------------------------- |
| `pnpm run init:template` | Initialiser le modÃ¨le avec vos informations |
| `pnpm run prepare`       | Installer les hooks Husky (au install)      |

---

## ðŸ”¨ SystÃ¨me de build (tsup)

[tsup](https://tsup.egoist.dev/) est un bundler TypeScript zero-config propulsÃ© par esbuild.

### Configuration

**tsup.config.ts :**

```typescript
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/index.ts"],
  format: ["esm", "cjs"],
  dts: true,
  clean: true,
  sourcemap: true,
});
```

### Sortie du build

```
dist/
â”œâ”€â”€ index.js      # Bundle ESM
â”œâ”€â”€ index.cjs     # Bundle CommonJS
â”œâ”€â”€ index.d.ts    # DÃ©clarations TypeScript (ESM)
â”œâ”€â”€ index.d.cts   # DÃ©clarations TypeScript (CJS)
â””â”€â”€ index.js.map  # Source maps
```

### Support double package

Le package supporte les consommateurs ESM et CommonJS :

```javascript
// ESM
import { hello } from "your-package";

// CommonJS
const { hello } = require("your-package");
```

---

## ðŸ§ª Tests (Vitest)

[Vitest](https://vitest.dev/) est un framework de tests unitaires ultra-rapide.

### Configuration

**vitest.config.ts :**

```typescript
import { defineConfig } from "vitest/config";

export default defineConfig({
  test: {
    globals: true,
    coverage: {
      provider: "v8",
      reporter: ["text", "html", "lcov"],
    },
  },
});
```

### Ã‰crire des tests

```typescript
// test/index.test.ts
import { describe, it, expect } from "vitest";
import { hello } from "../src/index";

describe("hello", () => {
  it("devrait retourner un message de salutation", () => {
    expect(hello("World")).toBe("Hello, World!");
  });
});
```

### Lancer les tests

```bash
# Une fois
pnpm run test

# Mode watch
pnpm run test:watch

# Avec couverture
pnpm run test:coverage
```

---

## ðŸ” QualitÃ© du code

### ESLint

ESLint 9 avec flat config pour TypeScript :

**eslint.config.mjs :**

```javascript
import eslint from "@eslint/js";
import tseslint from "typescript-eslint";
import prettierConfig from "eslint-config-prettier";

export default tseslint.config(
  eslint.configs.recommended,
  ...tseslint.configs.recommended,
  prettierConfig,
  {
    ignores: ["dist/", "docs/.vitepress/", "coverage/"],
  }
);
```

### Prettier

Formatage du code avec Prettier :

```bash
# VÃ©rifier le formatage
pnpm run format

# Corriger le formatage
pnpm run format:write
```

### publint

Valide la configuration des exports de votre `package.json` :

```bash
pnpm run lint:package
```

### knip

Trouve les dÃ©pendances, exports et fichiers inutilisÃ©s :

```bash
pnpm run lint:deps
```

---

## ðŸª Hooks Git (Husky + lint-staged)

[Husky](https://typicode.github.io/husky/) active les hooks Git, et [lint-staged](https://github.com/lint-staged/lint-staged) exÃ©cute les linters sur les fichiers stagÃ©s.

### Installation automatique

Husky est installÃ© automatiquement via le script `prepare` :

```json
{
  "scripts": {
    "prepare": "husky"
  }
}
```

### Hooks configurÃ©s

| Hook           | Fichier             | Actions                                     |
| -------------- | ------------------- | ------------------------------------------- |
| **pre-commit** | `.husky/pre-commit` | ExÃ©cute `lint-staged` sur fichiers stagÃ©s   |
| **pre-push**   | `.husky/pre-push`   | ExÃ©cute lint, typecheck, test, lint:package |
| **commit-msg** | `.husky/commit-msg` | (Optionnel) Valide les messages de commit   |

### Configuration lint-staged

DÃ©finie dans `package.json` :

```json
{
  "lint-staged": {
    "*.{ts,tsx,js,mjs,cjs}": ["eslint --fix", "prettier --write"],
    "*.{md,json,yml,yaml}": ["prettier --write"]
  }
}
```

### DÃ©tails des hooks

**pre-commit** (`.husky/pre-commit`) :

```bash
pnpm lint-staged
```

Corrige automatiquement les erreurs de lint et formate les fichiers stagÃ©s avant le commit.

**pre-push** (`.husky/pre-push`) :

```bash
pnpm run lint
pnpm run typecheck
pnpm run test
pnpm run lint:package
```

S'assure que toutes les vÃ©rifications passent avant de pusher.

### Contourner les hooks (urgence uniquement)

```bash
# Ignorer le hook pre-commit
git commit --no-verify -m "correctif urgent"

# Ignorer le hook pre-push
git push --no-verify
```

> âš ï¸ **Attention** : N'utilisez `--no-verify` qu'en cas d'urgence. La CI exÃ©cutera quand mÃªme toutes les vÃ©rifications.

---

## ðŸ“š Documentation (VitePress + TypeDoc)

### VitePress

[VitePress](https://vitepress.dev/) propulse le site de documentation.

**Configuration** (`docs/.vitepress/config.mts`) :

```typescript
import { defineConfig } from "vitepress";

export default defineConfig({
  title: "pkg_name",
  description: "pkg_name documentation",
  // Pour GitHub Pages avec un nom de repo personnalisÃ©, ajoutez :
  // base: "/nom-de-votre-repo/",
  themeConfig: {
    nav: [
      { text: "Guide", link: "/" },
      { text: "API", link: "/api" },
    ],
    sidebar: [
      {
        text: "DÃ©marrage",
        items: [{ text: "AperÃ§u", link: "/" }],
      },
      {
        text: "RÃ©fÃ©rence",
        items: [
          { text: "API (AperÃ§u)", link: "/api" },
          { text: "API (GÃ©nÃ©rÃ©e)", link: "/api-generated/" },
        ],
      },
    ],
  },
});
```

### TypeDoc

[TypeDoc](https://typedoc.org/) gÃ©nÃ¨re la documentation API Ã  partir des commentaires TSDoc.

**Configuration** (`typedoc.json`) :

```json
{
  "entryPoints": ["src/index.ts"],
  "out": "docs/api-generated",
  "plugin": ["typedoc-plugin-markdown"]
}
```

### Configuration GitHub Pages

> **Important** : Si votre dÃ©pÃ´t n'est pas Ã  la racine (ex: `username.github.io/nom-repo`), vous devez dÃ©finir l'option `base` dans la config VitePress :

```typescript
// docs/.vitepress/config.mts
export default defineConfig({
  base: "/NPM-Package/", // Remplacez par le nom de votre repo
  // ...
});
```

### DÃ©veloppement local

```bash
# DÃ©marrer le serveur de dev
pnpm run docs:dev

# Build la documentation
pnpm run docs:build

# PrÃ©visualiser les docs buildÃ©es
pnpm run docs:preview
```

---

## ðŸ“¦ Versionnage et publication (Changesets)

[Changesets](https://github.com/changesets/changesets) gÃ¨re le versionnage et les changelogs.

### Vue d'ensemble du workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WORKFLOW CHANGESETS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. DÃ‰VELOPPER                                               â”‚
â”‚     â””â”€> Apporter des modifications au code                  â”‚
â”‚                                                              â”‚
â”‚  2. CRÃ‰ER UN CHANGESET                                       â”‚
â”‚     â””â”€> pnpm run changeset                                  â”‚
â”‚         â€¢ SÃ©lectionner le type (patch/minor/major)          â”‚
â”‚         â€¢ Ã‰crire la description                             â”‚
â”‚         â€¢ CrÃ©e un fichier .changeset/*.md                   â”‚
â”‚                                                              â”‚
â”‚  3. COMMIT & PUSH                                           â”‚
â”‚     â””â”€> Le commit Git inclut le fichier changeset           â”‚
â”‚                                                              â”‚
â”‚  4. AUTOMATISÃ‰ (GitHub Actions)                             â”‚
â”‚     â”œâ”€> CrÃ©e une PR "Version Packages" avec :               â”‚
â”‚     â”‚   â€¢ Bump de version dans package.json                 â”‚
â”‚     â”‚   â€¢ CHANGELOG.md mis Ã  jour                           â”‚
â”‚     â”‚                                                        â”‚
â”‚     â””â”€> Ã€ la fusion de la PR : publie sur npm automatiquementâ”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Guide Ã©tape par Ã©tape

#### 1. CrÃ©er un changeset

AprÃ¨s vos modifications, crÃ©ez un changeset :

```bash
pnpm run changeset
```

Vous serez invitÃ© Ã  :

1. **SÃ©lectionner les packages** (appuyez sur `Espace` pour sÃ©lectionner, `EntrÃ©e` pour confirmer)
2. **Choisir le type de bump** :
   - `patch` (0.0.X) â€“ Corrections de bugs, documentation
   - `minor` (0.X.0) â€“ Nouvelles fonctionnalitÃ©s, rÃ©trocompatibles
   - `major` (X.0.0) â€“ Changements cassants
3. **Ã‰crire un rÃ©sumÃ©** â€“ DÃ©crivez les changements (apparaÃ®t dans le CHANGELOG)

#### 2. Fichier changeset

Un fichier markdown est crÃ©Ã© dans `.changeset/` :

```markdown
---
"your-package": minor
---

Ajout d'une nouvelle fonction utilitaire pour la transformation de donnÃ©es.
```

#### 3. Commiter le changeset

```bash
git add .changeset/
git commit -m "feat: ajout utilitaire de transformation"
git push
```

#### 4. Release automatisÃ©e (CI)

Le workflow `release.yml` :

1. **DÃ©tecte les changesets** au push sur `main`
2. **CrÃ©e/met Ã  jour** une PR "Version Packages" avec :
   - Version bumpÃ©e dans `package.json`
   - `CHANGELOG.md` mis Ã  jour
   - Fichiers changeset consommÃ©s
3. **Quand vous mergez** la PR Version Packages :
   - Publie sur npm automatiquement
   - CrÃ©e une release GitHub

### Configuration

**.changeset/config.json :**

```json
{
  "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",
  "changelog": "@changesets/cli/changelog",
  "commit": false,
  "fixed": [],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": []
}
```

### Release manuelle (Non recommandÃ©)

Si vous devez publier manuellement :

```bash
# Appliquer les changesets et bump les versions
pnpm run version-packages

# Build et publier
pnpm run build
pnpm run release
```

---

## ðŸ”„ CI/CD (GitHub Actions)

Trois workflows automatisent les vÃ©rifications qualitÃ©, la documentation et les releases.

### 1. Workflow CI (`ci.yml`)

**DÃ©clencheurs** : Push sur `main`, Pull Requests

**Ã‰tapes** :

| Ã‰tape            | Commande                |
| ---------------- | ----------------------- |
| Lint (ESLint)    | `pnpm run lint`         |
| Typecheck (tsc)  | `pnpm run typecheck`    |
| Tests unitaires  | `pnpm run test`         |
| Build (tsup)     | `pnpm run build`        |
| Lint package     | `pnpm run lint:package` |
| Deps inutilisÃ©es | `pnpm run lint:deps`    |
| Lint Markdown    | `pnpm run lint:md`      |
| Build docs       | `pnpm run docs:build`   |

### 2. Workflow Docs (`docs.yml`)

**DÃ©clencheurs** : Push sur `main`, DÃ©clenchement manuel

**Jobs** :

1. **Build** : GÃ©nÃ¨re la documentation avec VitePress
2. **Deploy** : Publie sur GitHub Pages

**PrÃ©requis** :

- Activer GitHub Pages dans les paramÃ¨tres du dÃ©pÃ´t
- DÃ©finir la source sur "GitHub Actions"

### 3. Workflow Release (`release.yml`)

**DÃ©clencheurs** : Push sur `main`

**Jobs** :

1. **Quality Gates** : ExÃ©cute lint, typecheck, test, build
2. **Action Changesets** :
   - Si des changesets existent : CrÃ©e une PR "Version Packages"
   - Si la PR Version Packages est mergÃ©e : Publie sur npm

**Secrets requis** :

| Secret         | Description                          |
| -------------- | ------------------------------------ |
| `GITHUB_TOKEN` | Automatique (pour crÃ©ation de PR)    |
| `NPM_TOKEN`    | Token d'accÃ¨s npm (pour publication) |

### Configurer NPM_TOKEN

1. Aller sur [npmjs.com](https://www.npmjs.com/) â†’ Compte â†’ Access Tokens
2. GÃ©nÃ©rer un nouveau token **Automation**
3. Dans le repo GitHub : Settings â†’ Secrets â†’ Actions
4. Ajouter `NPM_TOKEN` avec la valeur du token

---

## ðŸ”§ DÃ©pannage

### Erreur "Frozen lockfile" en CI

**Erreur** : `ERR_PNPM_FROZEN_LOCKFILE_WITH_OUTDATED_LOCKFILE`

**Cause** : `pnpm-lock.yaml` est dÃ©synchronisÃ© de `package.json`

**Solution** :

```bash
pnpm install
git add pnpm-lock.yaml
git commit -m "chore: mise Ã  jour du lockfile"
```

### 404 sur la documentation GitHub Pages

**Cause** : Chemin `base` manquant dans la config VitePress

**Solution** : Ajouter le base path dans `docs/.vitepress/config.mts` :

```typescript
export default defineConfig({
  base: "/nom-de-votre-repo/", // Doit correspondre au nom du repo GitHub
  // ...
});
```

### Erreur NPM_TOKEN manquant

**Erreur** : `NODE_AUTH_TOKEN` is not set

**Cause** : Token npm non configurÃ© dans les secrets GitHub

**Solution** :

1. CrÃ©er un token automation npm sur npmjs.com
2. L'ajouter comme `NPM_TOKEN` dans les secrets du repository GitHub

### Avertissements publint

**Avertissement** : ProblÃ¨mes d'exports du package

**Cause** : Les exports de `package.json` ne correspondent pas aux fichiers rÃ©els

**Solution** :

1. ExÃ©cuter `pnpm run build` pour gÃ©nÃ©rer les fichiers dist
2. VÃ©rifier que le champ `exports` correspond aux fichiers gÃ©nÃ©rÃ©s
3. ExÃ©cuter `pnpm run lint:package` pour valider

### Les hooks Husky ne s'exÃ©cutent pas

**Cause** : Hooks non installÃ©s ou Git non initialisÃ©

**Solution** :

```bash
# S'assurer que Git est initialisÃ©
git init

# RÃ©installer les hooks
pnpm run prepare
```

### Les tests Ã©chouent en CI mais passent localement

**Cause** : DiffÃ©rences d'environnement ou dÃ©pendances manquantes

**Solution** :

1. S'assurer que toutes les dÃ©pendances sont dans `devDependencies`
2. ExÃ©cuter avec `--frozen-lockfile` localement : `pnpm install --frozen-lockfile`
3. VÃ©rifier que la version Node.js correspond Ã  la CI (â‰¥20)

---

## ðŸ“„ Licence

Licence MIT Â© 2026 [Moaaz KHASSAWNEH](https://github.com/MoaazKHASSAWNEH)

Voir [LICENSE](LICENSE) pour les dÃ©tails.
